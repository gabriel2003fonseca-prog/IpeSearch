<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisar - IPÊ SEARCH</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <a href="index.html" class="logo-link">
            <img src="logo.png" alt="Logo IPÊ SEARCH" class="logo-img">
        </a>
        <a href="index.html" class="btn-voltar-home">INÍCIO</a>
    </header>
    
    <div id="search-view">
        <section class="search-section">
            <video class="video-bg" autoplay muted loop playsinline>
                <source src="video.mp4" type="video/mp4">
            </video>
            <div class="video-overlay"></div>

            <div class="search-content-wrapper">
                <h1 class="search-title">Encontre Professores da UFLA</h1>
                
                <div class="input-wrapper">
                    <div class="search-icon-left">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    </div>

                    <input type="text" id="searchInput" placeholder="Busque por nome, área, departamento...">
                    
                    <button id="clearBtn" class="btn-clear hidden" type="button" aria-label="Limpar pesquisa">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>

                <div class="quick-tags-container">
                    <button class="tag-btn" onclick="filtrarTag('Agronomia')">Agronomia</button>
                    <button class="tag-btn" onclick="filtrarTag('Zootecnia')">Zootecnia</button>
                    <button class="tag-btn" onclick="filtrarTag('Veterinária')">Veterinária</button>
                    <button class="tag-btn" onclick="filtrarTag('Eng. Florestal')">Eng. Florestal</button>
                    <button class="tag-btn" onclick="filtrarTag('Engenharia')">Engenharias</button>
                    <button class="tag-btn" onclick="filtrarTag('Computação')">Computação</button>
                    <button class="tag-btn" onclick="filtrarTag('Sistemas')">Sistemas</button>
                    <button class="tag-btn" onclick="filtrarTag('Direito')">Direito</button>
                    <button class="tag-btn" onclick="filtrarTag('Administração')">Administração</button>
                    <button class="tag-btn" onclick="filtrarTag('Medicina')">Medicina</button>
                    <button class="tag-btn" onclick="filtrarTag('Nutrição')">Nutrição</button>
                    <button class="tag-btn" onclick="filtrarTag('Biologia')">Biologia</button>
                    <button class="tag-btn" onclick="filtrarTag('Química')">Química</button>
                    <button class="tag-btn" onclick="filtrarTag('Física')">Física</button>
                    <button class="tag-btn" onclick="filtrarTag('Matemática')">Matemática</button>
                    <button class="tag-btn" onclick="filtrarTag('Pedagogia')">Pedagogia</button>
                    <button class="tag-btn" onclick="filtrarTag('Filosofia')">Filosofia</button>
                    <button class="tag-btn" onclick="filtrarTag('Letras')">Letras</button>
                    <button class="tag-btn" onclick="filtrarTag('Ed. Física')">Ed. Física</button>
                </div>
                
                <p style="margin-top: 25px; color: #003366; font-size: 0.95rem; font-weight: 600; opacity: 0.8; position: relative; z-index: 2;">
                    Toque em uma área acima ou digite para pesquisar.
                </p>
            </div>
        </section>

        <div id="counter" style="text-align: center; margin-top: 30px; color: #5A6A85; font-weight: 500;"></div>
        <div id="loading" style="text-align: center; padding: 20px; display: none; color: #003366;">Carregando dados...</div>

        <div class="results-container" id="resultsContainer">
            </div>
    </div>

    <div id="profile-view" class="hidden">
        <div style="height: 100px;"></div> 
        
        <div class="back-btn-container">
            <button type="button" class="btn-text-back" onclick="fecharPerfil()">
                ← Voltar para a pesquisa
            </button>
        </div>

        <div class="profile-card">
            <div class="profile-header">
                <h1 id="prof-nome">Nome do Professor</h1>
                <span class="dept-badge" id="prof-dept">Departamento</span>
            </div>

            <div class="profile-body">
                <div class="info-grid">
                    <div class="info-item">
                        <label>E-mail Institucional</label>
                        <p><a href="#" id="prof-email">email@ufla.br</a></p>
                    </div>
                    <div class="info-item">
                        <label>Telefone / Ramal</label>
                        <p id="prof-tel">N/A</p>
                    </div>
                    <div class="info-item">
                        <label>Área de Atuação</label>
                        <p id="prof-area">Área Principal</p>
                    </div>
                    <div class="info-item">
                        <label>Subárea</label>
                        <p id="prof-subarea">Especialidade</p>
                    </div>
                </div>

                <h2 class="section-title">Apresentação / Biografia</h2>
                <div class="text-content" id="prof-apresentacao"></div>

                <h2 class="section-title">Projetos de Pesquisa</h2>
                <div class="text-content" id="prof-projetos"></div>

                <div class="last-update" id="prof-update"></div>
            </div>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <script>
        // 1. Carregar o Rodapé Padronizado
        fetch('footer.html')
            .then(response => {
                if (!response.ok) throw new Error("Erro ao carregar footer");
                return response.text();
            })
            .then(data => {
                document.getElementById('footer-placeholder').innerHTML = data;
            })
            .catch(error => console.log('Aviso: Rode este projeto em um servidor local para ver o rodapé.', error));

        // 2. Lógica de Scroll do Header
        window.addEventListener('scroll', function() {
            const header = document.querySelector('header');
            if (window.scrollY > 50) { 
                header.classList.add('scrolled'); 
            } else { 
                header.classList.remove('scrolled'); 
            }
        });

        // ---------------------------------------------------------
        // 3. CONFIGURAÇÃO DA PLANILHA (LINK CSV CORRETO)
        // ---------------------------------------------------------
        // Nota: O link deve terminar com 'output=csv' para funcionar no código.
        const GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSbnwsZ8uZG9R0ienKTzjHlIAu4OIZcf0yIIi4wZSVVLlJrKKpAB0189mgr-oEoCYkp0I-Y18a6zDoV/pub?output=csv";

        // Dados de Exemplo (Só aparecem se a planilha falhar)
        const dadosExemplo = [
            { 
                Nome: "Dr. Exemplo", 
                Departamento: "Departamento de Teste", 
                Area: "Área Exemplo", 
                Subarea: "Subárea Exemplo",
                Email: "exemplo@ufla.br",
                Telefone: "(35) 0000-0000",
                Apresentacao: "Este é um dado de exemplo pois a planilha ainda não carregou.",
                Projetos: "- Projeto Exemplo 1",
                UltimaAtualizacao: "2026"
            }
        ];

        let todosPesquisadores = [];

        window.onload = async function() {
            const loading = document.getElementById('loading');
            
            if (GOOGLE_SHEET_CSV_URL && GOOGLE_SHEET_CSV_URL.startsWith("http")) {
                loading.style.display = 'block';
                try {
                    const response = await fetch(GOOGLE_SHEET_CSV_URL);
                    const texto = await response.text();
                    todosPesquisadores = csvParaJson(texto); 
                } catch (erro) {
                    console.error("Erro ao carregar planilha:", erro);
                    todosPesquisadores = dadosExemplo;
                }
                loading.style.display = 'none';
            } else {
                todosPesquisadores = dadosExemplo;
            }

            renderizarCards(todosPesquisadores);
        };

        // --- LÓGICA DO BOTÃO X E FILTRO ---
        const searchInput = document.getElementById('searchInput');
        const clearBtn = document.getElementById('clearBtn');

        searchInput.addEventListener('input', (e) => {
            const valor = e.target.value;
            toggleClearButton(valor);
            filtrarResultados(valor);
        });

        clearBtn.addEventListener('click', () => {
            searchInput.value = '';             
            toggleClearButton('');              
            filtrarResultados('');              
            searchInput.focus();                
        });

        function toggleClearButton(valor) {
            if (valor && valor.length > 0) {
                clearBtn.classList.remove('hidden');
            } else {
                clearBtn.classList.add('hidden');
            }
        }

        function filtrarTag(tag) {
            searchInput.value = tag;
            toggleClearButton(tag); 
            filtrarResultados(tag);
        }

        function filtrarResultados(termo) {
            termo = termo.toLowerCase();
            const filtrados = todosPesquisadores.filter(p => {
                const textoGeral = `${p.Nome} ${p.Departamento} ${p.Area} ${p.Subarea}`.toLowerCase();
                return textoGeral.includes(termo);
            });
            renderizarCards(filtrados);
        }

        function renderizarCards(lista) {
            const container = document.getElementById('resultsContainer');
            const counter = document.getElementById('counter');
            
            container.innerHTML = '';
            counter.innerText = lista.length > 0 ? `${lista.length} resultados encontrados` : '';

            if (lista.length === 0) {
                container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--text-gray); font-weight: 500;">Nenhum professor encontrado com esses termos.</p>';
                return;
            }

            lista.forEach(p => {
                const dataStr = '2026'; 

                const card = document.createElement('div');
                card.classList.add('card');
                card.onclick = () => abrirPerfil(p);
                
                card.innerHTML = `
                    <div class="lattes-badge">Fonte: Lattes</div>
                    <h3>${p.Nome}</h3>
                    <div class="card-dept">${p.Departamento}</div>
                    <div class="card-area">
                        <strong>Área:</strong> ${p.Area}<br>
                        <span style="font-size: 0.85rem; color: #666;">${p.Subarea}</span>
                    </div>
                    
                    <div class="card-footer">
                        <span style="font-size: 0.75rem; color: #aaa;">Atualizado: ${dataStr}</span>
                        <div class="card-hint">Ver perfil →</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function abrirPerfil(dados) {
            document.getElementById('prof-nome').innerText = dados.Nome;
            document.getElementById('prof-dept').innerText = dados.Departamento;
            
            const emailLink = document.getElementById('prof-email');
            emailLink.innerText = dados.Email || 'Não informado';
            emailLink.href = dados.Email ? `mailto:${dados.Email}` : '#';

            document.getElementById('prof-tel').innerText = dados.Telefone || 'Não informado';
            document.getElementById('prof-area').innerText = dados.Area || '-';
            document.getElementById('prof-subarea').innerText = dados.Subarea || '-';

            document.getElementById('prof-apresentacao').innerText = dados.Apresentacao || 'Nenhuma informação disponível.';
            document.getElementById('prof-projetos').innerText = dados.Projetos || 'Nenhum projeto cadastrado.';
            
            document.getElementById('prof-update').innerText = `Dados atualizados em: 2026`;

            document.getElementById('search-view').classList.add('hidden');
            document.getElementById('profile-view').classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function fecharPerfil() {
            document.getElementById('profile-view').classList.add('hidden');
            document.getElementById('search-view').classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        // --- FUNÇÃO PARA LER O CSV DA PLANILHA ---
        function csvParaJson(csv) {
            const linhas = csv.split('\n');
            const resultado = [];
            
            // Começamos do i=1 para pular o cabeçalho
            for (let i = 1; i < linhas.length; i++) {
                if (!linhas[i].trim()) continue;
                
                // Função simples para tratar CSV com aspas
                const linhaAtual = parseCSVLine(linhas[i]);
                
                if (linhaAtual && linhaAtual.length > 1) {
                    // Mapeamento das colunas (Baseado na sua planilha):
                    // 0: NOME | 1: DEPTO | 2: EMAIL | 3: TEL | 4: ÁREA | 5: SUBÁREA | 7: PROJETOS | 8: APRESENTAÇÃO
                    
                    const obj = {
                        Nome: linhaAtual[0] || 'Nome não informado',
                        Departamento: linhaAtual[1] || 'Departamento não informado',
                        Email: linhaAtual[2] || '',
                        Telefone: linhaAtual[3] || '',
                        Area: linhaAtual[4] || '',
                        Subarea: linhaAtual[5] || '',
                        Projetos: linhaAtual[7] || '',  // Coluna H
                        Apresentacao: linhaAtual[8] || '' // Coluna I
                    };
                    resultado.push(obj);
                }
            }
            return resultado;
        }

        // Função auxiliar para quebrar a linha do CSV respeitando aspas
        function parseCSVLine(text) {
            let p = '', row = [''], i = 0, r = 0, s = !0, l;
            for (l of text) {
                if ('"' === l) {
                    if (s && l === p) row[r] += l;
                    s = !s;
                } else if (',' === l && s) l = row[++r] = '';
                else row[r] += l;
                p = l;
            }
            return row.map(c => c.replace(/^"|"$/g, '').trim()); 
        }
    </script>

</body>
</html>
